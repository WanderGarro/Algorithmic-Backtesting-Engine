from indicators import EMA, SMA
from strategies import BaseStrategy
from pandas import DataFrame, Series

class SMACrossoverStrategy(BaseStrategy):
    """
    Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… ÑÐºÐ¾Ð»ÑŒÐ·ÑÑ‰Ð¸Ñ… ÑÑ€ÐµÐ´Ð½Ð¸Ñ… (SMA).
    Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¸ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ SMA.
    ÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ°Ñ Ñ‚Ñ€ÐµÐ½Ð´Ð¾Ð²Ð°Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ, Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ð°Ñ ÑÑ€ÐµÐ´Ð¸ Ñ‚Ñ€ÐµÐ¹Ð´ÐµÑ€Ð¾Ð².
    """

    def __init__(self, short_window: int = 20, long_window: int = 50):
        """
        Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ SMA.

        ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
            short_window (int, optional): ÐŸÐµÑ€Ð¸Ð¾Ð´ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ SMA (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 20)
            long_window (int, optional): ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ SMA (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 50)

        ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ:
            ÐšÑ€Ð°Ñ‚ÐºÐ¾ÑÑ€Ð¾Ñ‡Ð½Ð°Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»Ñ: ÐŸÐµÑ€Ð¸Ð¾Ð´Ñ‹ 5-20
            Ð¡Ñ€ÐµÐ´Ð½ÐµÑÑ€Ð¾Ñ‡Ð½Ð°Ñ: ÐŸÐµÑ€Ð¸Ð¾Ð´Ñ‹ 20-50
            Ð”Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð°Ñ: ÐŸÐµÑ€Ð¸Ð¾Ð´Ñ‹ 50-200
        """
        self.short_window = short_window
        self.long_window = long_window

    def generate_signals(self, data: DataFrame) -> Series:
        """
        Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ñ… ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ SMA.

        ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
            data (DataFrame): Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ Ñ†ÐµÐ½Ð°Ð¼Ð¸, Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ 'close'

        Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:
            Series: Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ðµ ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹: 1 (BUY), -1 (SELL), 0 (HOLD)

        Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ:
            ðŸŸ¢ ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ°: ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ°Ñ SMA Ð¿ÐµÑ€ÐµÑÐµÐºÐ°ÐµÑ‚ Ð´Ð»Ð¸Ð½Ð½ÑƒÑŽ SMA ÑÐ½Ð¸Ð·Ñƒ Ð²Ð²ÐµÑ€Ñ…
            ðŸ”´ ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð°: ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ°Ñ SMA Ð¿ÐµÑ€ÐµÑÐµÐºÐ°ÐµÑ‚ Ð´Ð»Ð¸Ð½Ð½ÑƒÑŽ SMA ÑÐ²ÐµÑ€Ñ…Ñƒ Ð²Ð½Ð¸Ð·
            âž¡ï¸ Ð”ÐµÑ€Ð¶Ð°Ñ‚ÑŒ: ÐÐµÑ‚ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð»Ð¸ Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ

        ÐŸÑ€Ð¸Ð¼ÐµÑ€:
        >>> prices = DataFrame([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
        >>> strategy = SMACrossoverStrategy(20, 50)
        >>> trend_signals = strategy.generate_signals(prices)
        """
        short_sma = SMA.calculate(data['close'], self.short_window)
        long_sma = SMA.calculate(data['close'], self.long_window)

        signals = Series(0, index=data.index)

        # ÐŸÐ¾ÐºÑƒÐ¿Ð°ÐµÐ¼ ÐºÐ¾Ð³Ð´Ð° ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ SMA Ð²Ñ‹ÑˆÐµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° SMA
        signals[short_sma > long_sma] = 1

        # ÐŸÑ€Ð¾Ð´Ð°ÐµÐ¼ ÐºÐ¾Ð³Ð´Ð° ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ SMA Ð½Ð¸Ð¶Ðµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° SMA
        signals[short_sma < long_sma] = -1

        return signals

class EMACrossoverStrategy(BaseStrategy):
    """
    Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ ÑÐºÑÐ¿Ð¾Ð½ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐºÐ¾Ð»ÑŒÐ·ÑÑ‰Ð¸Ñ… ÑÑ€ÐµÐ´Ð½Ð¸Ñ… (EMA).
    Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¸ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ EMA.
    Ð‘Ð¾Ð»ÐµÐµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ SMA ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð±Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ Ð±Ð¾Ð»ÑŒÑˆÐµÐ¼Ñƒ Ð²ÐµÑÑƒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ….
    """

    def __init__(self, short_window: int = 12, long_window: int = 26):
        """
        Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ EMA.

        ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
            short_window (int, optional) ÐŸÐµÑ€Ð¸Ð¾Ð´ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ EMA (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 12)
            long_window (int, optional) ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ EMA (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 26)

        ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ:
            ÐšÑ€Ð°Ñ‚ÐºÐ¾ÑÑ€Ð¾Ñ‡Ð½Ð°Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»Ñ: ÐŸÐµÑ€Ð¸Ð¾Ð´Ñ‹ 5-20
            Ð¡Ñ€ÐµÐ´Ð½ÐµÑÑ€Ð¾Ñ‡Ð½Ð°Ñ: ÐŸÐµÑ€Ð¸Ð¾Ð´Ñ‹ 20-50
            Ð”Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ð°Ñ: ÐŸÐµÑ€Ð¸Ð¾Ð´Ñ‹ 50-200
        """
        self.short_window = short_window
        self.long_window = long_window

    def generate_signals(self, data: DataFrame) -> Series:
        """
        Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ñ… ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð² Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿ÐµÑ€ÐµÑÐµÑ‡ÐµÐ½Ð¸Ñ EMA.

        ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:
            data (DataFrame): Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ Ñ†ÐµÐ½Ð°Ð¼Ð¸, Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ 'close'

        Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:
            Series: Ð¡ÐµÑ€Ð¸Ñ Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ð¼Ð¸ ÑÐ¸Ð³Ð½Ð°Ð»Ð°Ð¼Ð¸: 1 (BUY), -1 (SELL), 0 (HOLD)

        Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ:
            ðŸŸ¢ ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ°: ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ°Ñ EMA Ð²Ñ‹ÑˆÐµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ EMA
            ðŸ”´ ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð°: ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ°Ñ EMA Ð½Ð¸Ð¶Ðµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð¹ EMA
            âž¡ï¸ Ð”ÐµÑ€Ð¶Ð°Ñ‚ÑŒ:

        ÐŸÐ»ÑŽÑÑ‹:
            Ð‘Ñ‹ÑÑ‚Ñ€ÐµÐµ Ñ€ÐµÐ°Ð³Ð¸Ñ€ÑƒÐµÑ‚ Ð½Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ñ‚Ñ€ÐµÐ½Ð´Ð° Ñ‡ÐµÐ¼ SMA
            ÐœÐµÐ½ÑŒÑˆÐ°Ñ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ° ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
            Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ñ‚Ñ€ÐµÐ½Ð´Ð¾Ð²Ñ‹Ñ… Ñ€Ñ‹Ð½ÐºÐ°Ñ…

        ÐœÐ¸Ð½ÑƒÑÑ‹:
            ÐœÐ¾Ð¶ÐµÑ‚ Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð»Ð¾Ð¶Ð½Ñ‹Ðµ ÑÐ¸Ð³Ð½Ð°Ð»Ñ‹ Ð½Ð° Ð±Ð¾ÐºÐ¾Ð²Ñ‹Ñ… Ñ€Ñ‹Ð½ÐºÐ°Ñ…
            Ð‘Ð¾Ð»ÐµÐµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð° Ðº Ñ€Ñ‹Ð½Ð¾Ñ‡Ð½Ð¾Ð¼Ñƒ ÑˆÑƒÐ¼Ñƒ

       ÐŸÑ€Ð¸Ð¼ÐµÑ€:
        >>> prices = DataFrame([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
        >>> strategy = EMACrossoverStrategy(12, 26)
        >>> trend_signals = strategy.generate_signals(prices)
        """
        # Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÐ¼ EMA
        short_ema = EMA.calculate(data['close'], self.short_window)
        long_ema = EMA.calculate(data['close'], self.long_window)

        # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐµÑ€Ð¸ÑŽ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
        signals = Series(0, index=data.index)

        # ÐŸÐ¾ÐºÑƒÐ¿Ð°ÐµÐ¼ ÐºÐ¾Ð³Ð´Ð° ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ EMA Ð²Ñ‹ÑˆÐµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° EMA
        signals[short_ema > long_ema] = 1

        # ÐŸÑ€Ð¾Ð´Ð°ÐµÐ¼ ÐºÐ¾Ð³Ð´Ð° ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ EMA Ð½Ð¸Ð¶Ðµ Ð´Ð»Ð¸Ð½Ð½Ð¾Ð³Ð¾ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° EMA
        signals[short_ema < long_ema] = -1

        return signals